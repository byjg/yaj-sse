var SSE=function(e,n){function t(){u="event",(i=new EventSource(a)).successCount=0,i.onmessage=o.onMessage,i.onopen=function(e){0==i.successCount++&&o.onOpen(e)},i.onerror=function(e){e.target.readyState===EventSource.CLOSED&&o.onError(e)};for(var e in o.events)i.addEventListener(e,o.events[e],!1)}function r(){u="ajax",i={successCount:0,id:null,retry:3e3,data:"",event:""},s()}function s(){if(i){var e={"Last-Event-ID":i.id};for(var n in o.headers)e[n]=o.headers[n];Yaj.request({url:a,method:"GET",headers:e,success:function(e,n,t){if(i){0==i.successCount++&&o.onOpen();var r=e.split("\n");i.data="";var a=0;for(var u in r){var c=r[u].indexOf(":"),v=[r[u].substr(0,c),r[u].substr(c+1)];switch(v[0]){case"":v[1]||1!=a++||(eventMessage={data:i.data,lastEventId:i.id,origin:t.responseURL,returnValue:!0},i.event&&o.events[i.event]?o.events[i.event](eventMessage):o.onMessage(eventMessage),i.data="",i.event="",a=0);break;case"retry":a=0,i.retry=parseInt(v[1].trim());break;case"id":a=0,i.id=v[1].trim();break;case"event":a=0,i.event=v[1].trim();break;case"data":a=0,i.data+=(""!==i.data?"\n":"")+v[1].trim();break;default:a=0}}setTimeout(function(){s()},i.retry)}},error:o.onError})}}var a=e,o={onOpen:function(e){},onEnd:function(e){},onError:function(e){},onMessage:function(e){},options:{},headers:{},events:{}};yoCopy(n,o);var u=null,i=null;return{start:function(){return!i&&(!window.EventSource||o.options.forceAjax||Object.keys(o.headers).length>0?r():t(),!0)},stop:function(){return!!i&&(!window.EventSource||o.options.forceAjax||Object.keys(o.headers).length>0||i.close(),o.onEnd(),i=null,u=null,!0)}}};