var SSE=function(e,n){function t(){u="event",c=new EventSource(a),c.successCount=0,c.onmessage=o.onMessage,c.onopen=function(e){0===c.successCount++&&o.onOpen(e)},c.onerror=function(e){e.target.readyState===EventSource.CLOSED&&o.onError(e)};for(var e in o.events)c.addEventListener(e,o.events[e],!1)}function r(){u="ajax",c={successCount:0,id:null,retry:3e3,data:"",event:""},s()}function s(){if(c){var e={"Last-Event-ID":c.id};for(var n in o.headers)e[n]=o.headers[n];yo().request({url:a,method:"GET",headers:e,success:function(e,n,t){if(c){0===c.successCount++&&o.onOpen();var r=e.split("\n");c.data="";var a=0;for(var i in r){var u=r[i].indexOf(":"),v=[r[i].substr(0,u),r[i].substr(u+1)];switch(v[0]){case"":v[1]||1!==a++||(eventMessage={data:c.data,lastEventId:c.id,origin:t.responseURL,returnValue:!0},c.event&&o.events[c.event]?o.events[c.event](eventMessage):o.onMessage(eventMessage),c.data="",c.event="",a=0);break;case"retry":a=0,c.retry=parseInt(v[1].trim());break;case"id":a=0,c.id=v[1].trim();break;case"event":a=0,c.event=v[1].trim();break;case"data":a=0,c.data+=(""!==c.data?"\n":"")+v[1].trim();break;default:a=0}}setTimeout(function(){s()},c.retry)}},error:o.onError})}}var a=e,o={onOpen:function(e){},onEnd:function(e){},onError:function(e){},onMessage:function(e){},options:{},headers:{},events:{}};for(var i in n)o[i]=n[i];var u=null,c=null;return{start:function(){return c?!1:(!window.EventSource||o.options.forceAjax||Object.keys(o.headers).length>0?r(this):t(this),!0)},stop:function(){return c?(!window.EventSource||o.options.forceAjax||Object.keys(o.headers).length>0||c.close(),o.onEnd(),c=null,u=null,!0):!1}}};